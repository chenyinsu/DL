# Abandoning the Bayer-Filter to See in the Dark： 核心算法流程解析

## 一、 研究动机与核心问题

在极低光环境下进行图像增强是一个普遍但极具挑战性的问题。传统方法以及近期基于深度学习的方案（如SID、DeepISP）都存在一个根本性的限制：**其性能上限受限于彩色相机传感器通过拜尔滤波器（Bayer-Filter）所能捕获的光子信息量**。

拜尔滤波器覆盖在传感器上，每个像素点只允许一种颜色（R、G或B）的光子通过，这导致约 **2/3 的入射光子被过滤掉**。这极大地限制了在极低光条件下的信噪比和图像质量。

**核心洞察**：单色（Monochrome）相机传感器没有拜尔滤波器，因此可以捕获所有波长的光子，其光子捕获率和量子效率远高于彩色相机。这在极低光环境下能产生更清晰、噪声更少的图像。



**核心矛盾**：虽然双摄像头系统（一个彩色+一个单色）可以利用这一优势，但为移动设备配备额外的单色相机成本高昂。**因此，本研究的核心动机是**：**能否在仅有一个彩色相机的情况下，通过算法“模拟”一个单色相机，并融合两者的信息，从而突破传统彩色RAW数据的性能上限？**

## 二、 核心算法框架

该研究提出了一个端到端的卷积神经网络模型，其核心思想是**先模拟单色相机的输出，再融合彩色与模拟的单色信息进行增强**。整个 pipeline 如下图所示，包含两个核心模块：


### 模块一：去拜尔滤波器模块 (De-Bayer-Filter Module, DBF)

**目标**：学习一个映射函数，从彩色相机的RAW数据中生成（预测）出对应的单色RAW图像。这相当于在算法层面“移除”了拜尔滤波器，模拟了单色相机的成像过程。

*   **输入**：彩色RAW图像（通常为4通道，RGGB排列，分辨率 H/2 x W/2）。
*   **输出**：模拟的单色RAW图像（1通道，分辨率 H x W）。
*   **网络结构**：采用基于 **U-Net** 的全卷积网络。
*   **损失函数**：使用 **L1 Loss** 最小化预测的单色图像 `A_Mono` 与真实单色图像 `A_Mono^GT` 之间的差异。
*   **数学表达**：
    `A_Mono = f_M(A_Color)`
    其中 `f_M(·)` 即为DBF模块。

### 模块二：双分支低光增强模块 (Dual Branch Low-light Enhancement Module, DBLE)

**目标**：将原始的彩色RAW信息与DBF模块生成的（信息更丰富的）单色RAW信息进行融合，最终生成增强后的RGB图像。

*   **输入**：原始彩色RAW `A_Color` 和 DBF生成的单色RAW `A_Mono`。
*   **输出**：增强后的sRGB图像 `I_RGB`。
*   **网络结构**：采用**双分支U-Net**结构，其设计细节如下：
    1.  **双分支下采样**：两个独立的分支分别处理彩色RAW和单色RAW。这是因为两种数据在多个层面存在巨大差异：
        *   **模式**：彩色RAW有马赛克图案，单色RAW没有。
        *   **分辨率与通道数**：彩色RAW为4通道(H/2 x W/2)，单色RAW为1通道(H x W)。
        *   **信息类型**：彩色RAW包含颜色信息但光子数量少，单色RAW无颜色信息但光子数量多、细节更清晰。
    2.  **特征融合与通道注意力**：在下采样过程中，将两个分支的特征图在多个层级进行**拼接（Concatenation）**。随后，引入**通道注意力（Channel Attention, CA）层**对拼接后的特征进行重校准。
        *   **为什么需要CA？** 简单地拼接特征可能导致因域差异而产生的冲突。CA层可以自主学习两个域特征的重要性权重，建立互补交互，抑制矛盾，从而更有效地融合信息。
        *   **额外好处**：CA层中的下采样和上采样操作类似于“resize-convolution”，有助于**抑制U-Net中常见的棋盘格伪影（Checkerboard Artifacts）**。
*   **损失函数**：使用 **L1 Loss** 最小化输出的RGB图像 `I_RGB` 与真实长曝光RGB图像 `I_RGB^GT` 之间的差异。
*   **数学表达**：
    `I_RGB = f_C(A_Color; A_Mono)`
    其中 `f_C(·)` 即为DBLE模块。

## 三、 关键支撑：MCR数据集

为了训练和评估上述模型，本研究的一个关键贡献是构建了**单色-彩色RAW配对数据集（Mono-Colored Raw paired dataset, MCR）**。

*   **数据采集**：使用两个型号相同的相机，一个配备拜尔滤波器（彩色相机），一个不配备拜尔滤波器（单色相机）。将它们固定在滑动平台或固定架上，在相同曝光设置下同时对同一场景进行拍摄，从而获取配对的彩色RAW和单色RAW图像。
    

*   **数据后处理**：由于物理上无法完全对齐，通过**特征点匹配和单应性变换（Homography Transformation）** 对图像进行对齐。
*   **数据集规模**：包含约4000对图像，覆盖室内外多种场景和光照条件（50-14000 lux）。
*   **意义**：这是第一个公开的、由相同传感器捕获的彩色-单色RAW配对数据集，为训练和验证“去拜尔滤波器”这一任务提供了至关重要的数据基础。

## 四、 实验效果与验证

### 4.1 定量结果
在MCR数据集和修改后的SID数据集上，本方法（Ours）在PSNR和SSIM指标上均显著超越了之前的SOTA方法，如SID、LDC、RED等。

<table>
    <tr>
        <td></td>
        <td colspan="2">MCR Dataset</td>
        <td colspan="2">SID Dataset</td>
    </tr>
    <tr>
        <td></td>
        <td>PSNR(dB)</td>
        <td>SSIM</td>
        <td>PSNR(dB)</td>
        <td>SSIM</td>
    </tr>
    <tr>
        <td>SID[3]</td>
        <td>29.00</td>
        <td>0.906</td>
        <td>28.88</td>
        <td>0.787</td>
    </tr>
    <tr>
        <td>LDC[31]</td>
        <td>29.36</td>
        <td>0.904</td>
        <td>29.56</td>
        <td>0.799</td>
    </tr>
    <tr>
        <td>Ours</td>
        <td>31.69</td>
        <td>0.908</td>
        <td>29.65</td>
        <td>0.797</td>
    </tr>
</table>

### 4.2 定性结果
视觉效果对比表明，该方法生成的图像细节更丰富，噪声更少，颜色更自然，有效避免了其他方法中存在的颜色失真、雾状伪影、过度平滑和棋盘格伪影等问题。


### 4.3 消融实验
消融实验充分验证了各个核心组件的必要性：
1.  **通道注意力（CA）层**：移除CA层后性能显著下降，且会出现棋盘格伪影。
2.  **去拜尔滤波器（DBF）模块**：直接移除整个DBF模块（即仅用彩色RAW进行增强），性能大幅下降（PSNR从31.69dB降至29.99dB），这证明了**引入模拟单色信息的关键作用**。
3.  **输入形式**：验证了使用RAW数据以及packed RAW格式的必要性，使用sRGB输入或未pack的RAW会导致性能下降。

<table>
    <tr>
        <td>Ablation Setting</td>
        <td>PSNR(dB)</td>
        <td>SSIM</td>
    </tr>
    <tr>
        <td>Full Model (Baseline)</td>
        <td>31.69</td>
        <td>0.908</td>
    </tr>
    <tr>
        <td>w/o CA layer</td>
        <td>29.23</td>
        <td>0.873</td>
    </tr>
    <tr>
        <td>w/o DBF module</td>
        <td>29.99</td>
        <td>0.884</td>
    </tr>
</table>

## 五、 总结

本研究从一个新颖的物理视角出发，揭示了传统低光增强算法的性能瓶颈在于拜尔滤波器对光子信息的限制。并据此提出了一个巧妙的解决方案：

1.  **算法模拟物理**：通过DBF模块在算法上“移除”拜尔滤波器，从彩色RAW中预测出信息更丰富的单色RAW图像。
2.  **高效融合信息**：通过双分支DBLE模块和通道注意力机制，自适应地融合彩色和模拟单色信息，实现卓越的低光增强效果。
3.  **数据驱动验证**：构建了全新的MCR数据集，为整个研究提供了坚实的基础。

该工作表明，**将物理洞察（光子捕获效率）与数据驱动方法（深度学习）相结合**，能够突破传统图像处理管道的固有限制，为计算摄影领域提供了新的思路。
